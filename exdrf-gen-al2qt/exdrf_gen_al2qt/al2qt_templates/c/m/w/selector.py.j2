# This file was automatically generated using the exdrf_gen package.
# Source: {{ source_module }} -> {{ source_templ }}
# Don't change it manually.

from typing import TYPE_CHECKING

from exdrf_qt.field_ed.fed_sel_one import DrfSelOneEditor
from exdrf_qt.field_ed.fed_sel_multi import DrfSelMultiEditor
from exdrf_qt.plugins import exdrf_qt_pm
from exdrf_qt.utils.plugins import safe_hook_call

# exdrf-keep-start other_imports ----------------------------------------------
{{other_imports}}
# exdrf-keep-end other_imports ------------------------------------------------

if TYPE_CHECKING:
    from exdrf_qt.context import QtContext  # noqa: F401
    {%- if r.provides or r.depends_on %}
    from exdrf_qt.controls.base_editor import ExdrfEditorBase
    {%- endif %}

# exdrf-keep-start other_globals ----------------------------------------------
{{other_globals}}
# exdrf-keep-end other_globals ------------------------------------------------


class Qt{{ ResPascal }}SiSe(DrfSelOneEditor):
    """Reads the list of records from the database and allows the user to
    select one.
    """
    # exdrf-keep-start other_sise_attributes ----------------------------------
{{other_sise_attributes}}
    # exdrf-keep-end other_sise_attributes ------------------------------------

    def __init__(self, ctx: "QtContext", **kwargs):
        from {{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.models.{{ res_snake }}_ocm import (
            Qt{{ ResPascal }}NaMo
        )
        from {{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.widgets.{{ res_snake }}_editor import (
            Qt{{ ResPascal }}Editor,
        )
        {%- if r.provides or r.depends_on %}
        {% endif %}

        DrfSelOneEditor.__init__(
            self,
            qt_model=kwargs.pop("qt_model", ctx.get_c_ovr(
                "{{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.selector.model",
                Qt{{ ResPascal }}NaMo,
                ctx=ctx,
                prevent_total_count=True,
            )),
            editor_class=kwargs.pop("editor_class", ctx.get_ovr(
                "{{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.selector.editor",
                Qt{{ ResPascal }}Editor,
            )),
            ctx=ctx,
            **kwargs
        )
        self.qt_model.setParent(self)

        # Inform plugins that the widget has been created.
        safe_hook_call(
            exdrf_qt_pm.hook.{{ res_snake }}_sise_created,
            widget=self
        )

        # exdrf-keep-start extra_sise_init -----------------------------------
{{extra_sise_init}}
        # exdrf-keep-end extra_sise_init -------------------------------------
    
    {%- if r.provides or r.depends_on %}

    def set_form(self, form: "ExdrfEditorBase"):
        super().set_form(form)

        {%- if r.provides %}

        # Register providers for the concepts that this widget provides.
        {%- for concept in r.provides %}
        form.constraints.register_provider(
            concept="{{ concept }}",
            provider=self,
        )
        {%- endfor %}
        {%- endif %}

        {%- if r.depends_on %}

        # Register subscribers for the concepts that this widget depends on.
        {%- for concept, target in r.depends_on %}
        form.constraints.register_subscriber(
            concept="{{ concept }}",
            subscriber=self,
        )
        {%- endfor %}
        {%- endif %}
    {%- endif %}

    # exdrf-keep-start extra_sise_content ------------------------------------
{{extra_sise_content}}
    # exdrf-keep-end extra_sise_content --------------------------------------


class Qt{{ ResPascal }}MuSe(DrfSelMultiEditor):
    """Reads the list of records from the database and allows the user to
    select multiple records.
    """
    # exdrf-keep-start other_muse_attributes ----------------------------------
{{other_muse_attributes}}
    # exdrf-keep-end other_muse_attributes ------------------------------------

    def __init__(self, ctx: "QtContext", **kwargs):
        from {{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.models.{{ res_snake }}_ocm import (
            Qt{{ ResPascal }}NaMo
        )
        from {{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.widgets.{{ res_snake }}_editor import (
            Qt{{ ResPascal }}Editor,
        )

        DrfSelMultiEditor.__init__(
            self,
            qt_model=kwargs.pop("qt_model", ctx.get_c_ovr(
                "{{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.selector.model",
                Qt{{ ResPascal }}NaMo,
                ctx=ctx,
                prevent_total_count=True,
            )),
            editor_class=kwargs.pop("editor_class", ctx.get_ovr(
                "{{ out_module }}.{{ categories[0] }}.{{ res_p_snake }}.selector.editor",
                Qt{{ ResPascal }}Editor,
            )),
            ctx=ctx,
            **kwargs
        )
        self.qt_model.setParent(self)

        # Inform plugins that the widget has been created.
        safe_hook_call(
            exdrf_qt_pm.hook.{{ res_snake }}_muse_created,
            widget=self
        )

        # exdrf-keep-start extra_muse_init -----------------------------------
{{extra_muse_init}}
        # exdrf-keep-end extra_muse_init -------------------------------------

    {%- if r.depends_on %}

    def set_form(self, form: "ExdrfEditorBase"):
        super().set_form(form)

        # Register subscribers for the concepts that this widget depends on.
        {%- for concept, target in r.depends_on %}
        form.constraints.register_subscriber(
            concept="{{ concept }}",
            subscriber=self,
        )
        {%- endfor %}
    {%- endif %}

    # exdrf-keep-start extra_muse_content ------------------------------------
{{extra_muse_content}}
    # exdrf-keep-end extra_muse_content --------------------------------------


# exdrf-keep-start more_content ------------------------------------------------
{{more_content}}
# exdrf-keep-end more_content --------------------------------------------------
{{- "\n" -}}
